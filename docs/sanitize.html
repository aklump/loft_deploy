<!DOCTYPE html>

<html>
<head>
  <title>Sanitize Settings Files</title>
  <link href="search/tipuesearch.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>

<body class="page--sanitize">
<header>
  <div class="pager"><a href="overview.html" class="prev overview">&laquo;Overview</a><a href="index.html" class="index pager__book-title">Loft Deploy</a><a href="pantheon.html" class="next pantheon">Support for Pantheon Websites&raquo;</a></div></header>
<section class="sub-header">
  <div class="breadcrumbs"><a href="index.html">Index</a>
         &raquo
      </div>      <div class="search__wrapper">
  <form action="search--results.html">
    <input type="text" class="search-input" name="q" id="tipue_search_input" autocomplete="off" required>
  </form>
</div>
  </section>


<h1>Sanitize Settings Files</h1>

<section>

<p>In the case of projects like Drupal, Wordpress, Mediawiki, etc, all of which contain settings files with passwords and sensitive information that should never be committed to source control, you should set up some <a href="hooks.html">hooks</a> to scrub these files, if you've included them in <code>copy_source</code>.</p>

<p>The following is an excerpt from mediawiki of an unsanitized settings file.</p>

<pre><code>    &lt;?php
    # This file was automatically generated by the MediaWiki 1.18.2
    # installer. If you make manual changes, please keep track in case you
    # need to recreate them later.
    #
    ...
    ## Database settings
    $wgDBtype           = "mysql";
    $wgDBserver         = "localhost";
    $wgDBname           = "wiki";
    $wgDBuser           = "wiki";
    $wgDBpassword       = "0e6409df6fe6af1c27f83bba3";
    ...
    $wgSecretKey = "d18ed14a95e60e6409df6fe6af1c27f83bba3d5c54773a2aacc0e4e57622f67c";
    ...
</code></pre>

<p>After sanitization:</p>

<pre><code>    &lt;?php
    # This file was automatically generated by the MediaWiki 1.18.2
    # installer. If you make manual changes, please keep track in case you
    # need to recreate them later.
    #
    ...
    ## Database settings
    $wgDBtype           = "mysql";
    $wgDBserver         = "localhost";
    $wgDBname           = "wiki";
    $wgDBuser           = "wiki";
    $wgDBpassword       = NULL;
    ...
    $wgSecretKey = NULL;
    ...
</code></pre>

<h2>Production/Staging Environments</h2>

<ul>
<li>These should be sanitized on <code>fetch</code>.</li>
<li><p>Use <em>fetch_files_post.sh</em> with something like the following:</p>

<pre><code>file="$5/1~LocalSettings.$6.php"
hooks_set_vars_to_null $file "wgDBpassword,wgSecretKey" || return 1
echo_green "└── Sensitive data removed from: ${file##*/}"

return 0
</code></pre></li>
</ul>

<p>The above example code will sanitize <em>LocalSettings.php</em> coming from both <em>prod</em> and <em>staging</em> environments, setting the variables <code>$wgDBpassword</code> and <code>$wgSecretKey</code> to NULL as in the example shown above.</p>

<h2>Local Development</h2>

<ul>
<li>These should be sanitized on <code>reset</code>.</li>
<li><p>Use <em>reset_files_post.sh</em> with something like the following:</p>

<pre><code>file="$4/install/LocalSettings.dev.php"
hooks_set_vars_to_null $file "wgDBpassword,wgSecretKey" || return 1
echo_green "└── Sensitive data removed from: ${file##*/}"

return 0      
</code></pre></li>
</ul>

<p>The above example code will sanitize only <em>LocalSettings.php</em> coming from your local dev environment, setting the variables <code>$wgDBpassword</code> and <code>$wgSecretKey</code> to NULL.</p>

<h2>Sanitization API</h2>

<p>The following functions should be considered for sanitization:</p>

<ul>
<li><code>hooks_empty_array_key</code></li>
<li><code>hooks_empty_drupal_conf</code></li>
<li><code>hooks_set_vars_to_null</code></li>
</ul>
</section>

<div class="search__results">
  <div id="tipue_search_content"></div>
</div>

<footer>
  <div class="pager"><a href="overview.html" class="prev overview">&laquo;Overview</a><a href="index.html" class="index pager__book-title">Loft Deploy</a><a href="pantheon.html" class="next pantheon">Support for Pantheon Websites&raquo;</a></div>  
  <div id="footer-legaleeze">
    <p class="legaleeze center">Version: 1.0 &bull; Last Updated: Mon, 15 Jun 2020 14:32:44 -0700</p>
  </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="search/tipuesearch_content.js"></script>
  <script src="search/tipuesearch_set.js"></script>
  <script src="search/tipuesearch.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#tipue_search_input').tipuesearch()
    })
  </script>
<script src="js/core.js"></script>
</body>
</html>

